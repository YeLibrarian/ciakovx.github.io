<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />




<title>Data Exploration</title>

<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/paper.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="site_libs/jqueryui-1.11.4/jquery-ui.min.js"></script>
<link href="site_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/highlightjs-9.12.0/default.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>
<link href="site_libs/pagedtable-1.1/css/pagedtable.css" rel="stylesheet" />
<script src="site_libs/pagedtable-1.1/js/pagedtable.js"></script>

<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>



<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>

<link rel="stylesheet" href="styles.css" type="text/css" />



<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
  height: auto;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
</style>


<style type="text/css">
/* padding for bootstrap navbar */
body {
  padding-top: 64px;
  padding-bottom: 40px;
}
/* offset scroll position for anchor links (for fixed navbar)  */
.section h1 {
  padding-top: 69px;
  margin-top: -69px;
}
.section h2 {
  padding-top: 69px;
  margin-top: -69px;
}
.section h3 {
  padding-top: 69px;
  margin-top: -69px;
}
.section h4 {
  padding-top: 69px;
  margin-top: -69px;
}
.section h5 {
  padding-top: 69px;
  margin-top: -69px;
}
.section h6 {
  padding-top: 69px;
  margin-top: -69px;
}
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #ffffff;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script>
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.parent().addClass('active');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  background: white;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->



<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}


.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
}

.tocify .list-group-item {
  border-radius: 0px;
}

.tocify-subheader {
  display: inline;
}
.tocify-subheader .tocify-item {
  font-size: 0.95em;
}

</style>



</head>

<body>


<div class="container-fluid main-container">


<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row-fluid">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">Clarke Iakovakis</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    FSCI 2019 AM4 Session
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="fsci_syllabus.html">Course syllabus</a>
    </li>
    <li>
      <a href="setup_instructions.html">Setting Up</a>
    </li>
    <li>
      <a href="IntroductionToR.html">Introduction to R</a>
    </li>
    <li>
      <a href="RBasics.html">R Basics</a>
    </li>
    <li>
      <a href="DataExploration.html">Data Exploration</a>
    </li>
    <li>
      <a href="jennybc_lists_lesson.html">Exploring Data in Lists</a>
    </li>
    <li>
      <a href="rorcid.html">rorcid</a>
    </li>
    <li>
      <a href="rcrossref.html">rcrossref</a>
    </li>
  </ul>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div class="fluid-row" id="header">



<h1 class="title toc-ignore">Data Exploration</h1>

</div>


<p>This is distributed under a <a href="Creative%20Commons%20Attribution%204.0%20International%20(CC%20BY%204.0)%20License">https://creativecommons.org/licenses/by/4.0/</a>.</p>
<p>Workshop code for this module is at <a href="https://raw.githubusercontent.com/ciakovx/ciakovx.github.io/master/DataExploration_workshopcode.R" class="uri">https://raw.githubusercontent.com/ciakovx/ciakovx.github.io/master/DataExploration_workshopcode.R</a></p>
<div id="getting-data-into-r" class="section level1">
<h1>Getting data into R</h1>
<div id="ways-to-get-data-into-r" class="section level2">
<h2>Ways to get data into R</h2>
<p>In order to use your data in R, you must import it and turn it into an R <em>object</em>. There are many ways to get data into R.</p>
<ul>
<li><strong>Manually</strong>: You can manually create it as we did at the end of last session. To create a data.frame, use the <code>data.frame()</code> and specify your variables.</li>
<li><strong>Import it from a file</strong> Below is a very incomplete list</li>
<li>Text: TXT (<code>readLines()</code> function)</li>
<li>Tabular data: CSV, TSV (<code>read.table()</code> function or <code>readr</code> package)</li>
<li>Excel: XLSX (<code>xlsx</code> package)</li>
<li>Google sheets: (<code>googlesheets</code> package)</li>
<li>Statistics program: SPSS, SAS (<code>haven</code> package)</li>
<li>Databases: MySQL (<code>RMySQL</code> package)</li>
<li><strong>Gather it from the web</strong>: You can connect to webpages, servers, or APIs directly from within R, or you can create a data scraped from HTML webpages using the <code>rvest</code> package.</li>
<li>For example, connect to the Twitter API with the <a href="https://sites.google.com/site/miningtwitter/questions/talking-about/wordclouds/wordcloud1"><code>twitteR</code></a> package, or Altmetrics data with <a href="https://cran.r-project.org/web/packages/rAltmetric/vignettes/intro-to-altmetric.html"><code>rAltmetric</code></a>, or World Bank’s World Development Indicators with <a href="https://cran.r-project.org/web/packages/WDI/WDI.pdf"><code>WDI</code></a>.</li>
</ul>
</div>
<div id="readr" class="section level2">
<h2><code>readr</code></h2>
<p>R has some base functions for reading a local data file into your R session–namely <code>read.table()</code> and <code>read.csv()</code>, but these have some idiosyncrasies that were improved upon in the <code>readr</code> package, which is installed and loaded with <code>tidyverse</code>. You can either load <code>tidyverse</code>, which will automatically load <code>readr</code>, or you can load <code>readr</code> individually.</p>
<pre class="r"><code>library(tidyverse)

# or

library(readr)</code></pre>
<p>For this session, we will be reading a CSV from a web connection rather than saving the data to our computer and loading it into R. However, to do that, see the below section on <a href="#loadlocal">Loading data from a local file</a>.</p>
<p>To get our sample data into our R session, we will use the <code>read_csv()</code> function and connect to a CSV saved on my GitHub using the <code>url()</code> function.</p>
<pre class="r"><code>books_url &lt;- url(&quot;https://raw.githubusercontent.com/ciakovx/ciakovx.github.io/master/RBasics_files/data/raw/books.csv&quot;)
books &lt;- readr::read_csv(books_url)
books</code></pre>
<p>You will notice a warning message telling you that because you did not specify the data type for each column, <code>read_csv()</code> parsed it automatically. For example, <code>LOCATION</code> was parsed as a <code>col_character()</code> field. You should now have an R object called <code>books</code> in the Environment pane: 10000 observations of 12 variables. We will be using this data file in the next module.</p>
<p><img src="DataExploration_files/figure-html/unnamed-chunk-2-1.png" width="672" /></p>
</div>
<div id="loadlocal" class="section level2">
<h2>Loading data from a local file</h2>
<div id="set-your-working-directory" class="section level3">
<h3>Set your working directory</h3>
<p>The <strong>working directory</strong> is the location on your computer R will use for reading and writing files. Use <code>getwd()</code> to print your current working directory to the console. Use <code>setwd()</code> to set your working directory. There are two important points to make here;</p>
<ul>
<li>On Windows computers, directories in file paths are separated with a backslash <code>\</code>. However, in R, you must use a forward slash <code>/</code>. I usually copy and paste from the Windows Explorer (or Mac Finder) window directly into R and use the find/replace (Ctrl/Cmd + F).</li>
<li>The directory must be in quotation marks.</li>
</ul>
<p><img src="DataExploration_files/figure-html/unnamed-chunk-3-1.png" width="672" /></p>
<pre class="r"><code># set working directory using a forward slash /
setwd(&quot;C:/Users/iakovakis/Desktop/fsci_AM4&quot;)

# print working directory to the console
getwd()
## [1] &quot;C:/Users/iakovakis/Desktop/fsci_AM4&quot;</code></pre>
</div>
</div>
<div id="now-you-can-use-period-slash-.-to-represent-the-working-directory.-so-.data-is-the-same-as-cusersiakovakisdocumentsfsci_am4data" class="section level2">
<h2>Now, you can use period-slash <code>./</code> to represent the working directory. So <code>"./data"</code> is the same as <code>"C:/Users/iakovakis/Documents/fsci_AM4/data"</code></h2>
<p><strong>TRY IT YOURSELF</strong></p>
<pre class="r"><code># set your working directory to wherever you saved the data files for this webinar
setwd(&quot;C:/Wherever you saved the files/fsci_AM4_files&quot;)

# read the books file into your R environment and assign it to books
# not all of these arguments are necessary, but I&#39;m putting them here for example purposes
books &lt;- readr::read_csv(&quot;./data/raw/books.csv&quot;)</code></pre>
</div>
<div id="import-dataset-tool-in-r-studio" class="section level2">
<h2>Import Dataset tool in R Studio</h2>
<p>R Studio has a data importing wizard in the Environment Pane (upper right): <strong>Import Dataset:</strong> <img src="DataExploration_files/figure-html/unnamed-chunk-4-1.png" width="672" /></p>
<p>I never use this. I type the <code>read_csv()</code> function directly in my script files, as it gives me more control over the arguments and I am not limited to the choices R Studio gives me.</p>
</div>
</div>
<div id="data-exploration" class="section level1">
<h1>Data exploration</h1>
<p>After you read in the data, you want to examine it not only to make sure it was read in correctly, but also to gather some basic information about it. Here I am working with the data file that was provided to you during the webinar session. Read this file by saving it to your computer, setting your working directory, and typing the expression found in the <strong>TRY IT YOURSELF</strong> exercise at the end of Section 2.</p>
<div id="exploring-dataframes" class="section level2">
<h2>Exploring dataframes</h2>
<pre class="r"><code># Look at the data in the viewer
View(books)

# Use dim() to obtain the dimensions
dim(books)
## [1] 10000   12

# print the column names
names(books)

# nrow() is number of rows. 
nrow(books)
## [1] 10000
ncol(books)
## [1] 12

# Use head() and tail() to get the first and last 6 observations
# View more by adding the n argument
head(books)
head(books, n = 10)</code></pre>
<p>The <code>map()</code> series of function from <code>purrr</code> is a useful way of running a function on all variables in a data frame or list. Here we call <code>class()</code> on <code>books</code> using <code>map_chr()</code>, which will return a character vector of the classes for each variable.</p>
<pre class="r"><code>map_chr(books, class)
## CALL...BIBLIO.        X245.ab         X245.c       LOCATION     
##   &quot;character&quot;    &quot;character&quot;    &quot;character&quot;    &quot;character&quot;      
##    tot_chkout       LOUTDATE        SUBJECT            ISN   
##     &quot;integer&quot;    &quot;character&quot;    &quot;character&quot;    &quot;character&quot;    
##  CALL...ITEM.  X008.Date.One          BCODE2         BCODE1 
##    &quot;character&quot;      &quot;integer&quot;    &quot;character&quot;    &quot;character&quot; </code></pre>
</div>
<div id="exploring-variables" class="section level2">
<h2>Exploring variables</h2>
<div id="dollar-sign" class="section level3">
<h3>Dollar sign</h3>
<p>The dollar sign <code>$</code> is used to distinguish a specific variable (column, in Excel-speak) in a data frame:</p>
<pre class="r"><code># print the first six book titles
head(books$title)
## [1] &quot;NAEP 1998 writing state report for Texas /&quot;
## [2] &quot;The World almanac and book of facts.&quot;
## [3] &quot;McGraw-Hill reading.&quot;
## [4] &quot;TASP Texas Academic Skills Program policy manual.&quot;
## [5] &quot;The control room :~how television calls the shots in presidential elections /&quot;
## [6] &quot;IEEE transactions on information technology in biomedicine :~a publication of the IEEE Engineering in Medicine and Biology Society.&quot;

# print the mean number of checkouts
mean(books$tot_chkout)
## [1] 2.2847</code></pre>
</div>
<div id="unique-table-and-duplicated" class="section level3">
<h3><code>unique()</code>, <code>table()</code>, and <code>duplicated()</code></h3>
<p>Use <code>unique()</code> to see all the distinct values in a variable:</p>
<pre class="r"><code>unique(books$LOCATION)
##  [1] &quot;clstk&quot; &quot;cltxd&quot; &quot;clfhd&quot; &quot;cljuv&quot; &quot;clusd&quot; &quot;cljre&quot; &quot;clref&quot; &quot;clua &quot; ...</code></pre>
<p>Take that one step further with <code>table()</code> to get quick frequency counts on a variable:</p>
<pre class="r"><code>table(books$LOCATION)
## clcdr clchi clcir clcre clfhd clfyi clids cljre cljuv 
##   135   410    18    10   898     1    24   270   430     

# you can use it with relational operators 
# Here we find that 9 books have over 50 checkouts
table(books$TOT.CHKOUT &gt; 50)
## FALSE  TRUE 
##  9991     9</code></pre>
<p><code>duplicated()</code> will give you the a logical vector of duplicated values.</p>
<pre class="r"><code># The books dataset doesn&#39;t have much duplication, we&#39;ll create a new vector to test this.
mydupes &lt;- tibble(&quot;identifier&quot; = c(&quot;111&quot;, &quot;222&quot;, &quot;111&quot;, &quot;333&quot;, &quot;444&quot;),
                  &quot;birthYear&quot; = c(1980, 1940, 1980, 2000, 1960))

mydupes
##  identifier birthYear
## 1        111      1980
## 2        222      1940
## 3        111      1980
## 4        333      2000
## 5        444      1960

# The second 111 is duplicated
duplicated(mydupes$identifier)
## [1] FALSE FALSE  TRUE FALSE FALSE

# you can put an exclamation mark before it to get non-duplicated values
!duplicated(mydupes$identifier)
## [1]  TRUE  TRUE FALSE  TRUE  TRUE

# or run a table of duplicated values
table(duplicated(mydupes$identifier))
## FALSE  TRUE 
## 4     1

# which() is also a useful function for identifying the specific element
# in the vector that is duplicated
which(duplicated(mydupes$identifier))
## [1] 3</code></pre>
</div>
</div>
<div id="exploring-missing-values" class="section level2">
<h2>Exploring missing values</h2>
<p>You may also need to know the number of missing values:</p>
<pre class="r"><code># How many total missing values?
sum(is.na(books))
## [1] 5591

# Total missing values per column
colSums(is.na(books))

# use table() and is.na() in combination
table(is.na(books$isbn))
## FALSE  TRUE 
##2893  1107 

# Return only observations that have no missing values
booksNoNA &lt;- na.omit(books)</code></pre>
<hr />
<p><strong>TRY IT YOURSELF</strong></p>
<ol style="list-style-type: decimal">
<li>Call <code>View(books)</code> to examine the data frame.</li>
</ol>
<ul>
<li>Use the small arrow buttons in the variable name to sort tot_chkout by the highest checkouts. What item has the most checkouts?</li>
<li>Use the search bar on the right to search for the term Mathematics.</li>
<li>Click the Filter button above the first variable. Filter the X008.Date.One variable to see only books published after 1960.</li>
</ul>
<ol start="2" style="list-style-type: decimal">
<li>What is the class of the TOT.CHKOUT variable?</li>
<li>The publication date variable is represented with X008.Date.One. Use the <code>table()</code> function to get frequency counts of this variable</li>
<li>Use <code>table()</code> and <code>is.na()</code> to find out how many NA values are in the ISN variable.</li>
<li>Use <code>which()</code> and <code>is.na()</code> to find out which rows are NA in the ISN variable. What happened?</li>
<li>Use <code>which()</code> and <code>!is.na()</code> to find out which rows are <strong>not</strong> NA in ISN. (<code>!is.na()</code> is the same thing as <code>complete.cases()</code>)</li>
<li>Refer back to Section 4.3 in the <em>Nuts &amp; Bolts of R</em> handout for Part 1: “Subsetting vectors.” Subset the books$ISN vector using <code>!is.na()</code> to include only those values that are not NA.</li>
<li>Call <code>summary(books$TOT.CHKOUT)</code>. What can we infer when we compare the mean, median, and max?</li>
<li><code>hist()</code> will print a rudimentary histogram, which displays frequency counts. Call <code>hist(books$TOT.CHKOUT)</code>. What is this telling us?</li>
</ol>
<hr />
</div>
</div>
<div id="logical-tests" class="section level1">
<h1>Logical tests</h1>
<p>R contains a number of operators you can use to compare values. Use <code>help(Comparison)</code> to read the R help file. Note that <strong>two equal signs</strong> (<code>==</code>) are used for evaluating equality (because one equals sign (<code>=</code>) is used for assigning variables).</p>
<p>Sometimes you need to do multiple logical tests (think Boolean logic). Use <code>help(Logic)</code> to read the help file.</p>
<hr />
<p><strong>TRY IT YOURSELF</strong></p>
<ol style="list-style-type: decimal">
<li>Evaluate the following expressions and consider the results.</li>
</ol>
<pre class="r"><code>8 == 8
8 == 16
8 != 16
8 &lt; 16
8 == 16 - 8
8 == 8 &amp; 8 &lt; 16
8 == 8 | 8 &gt; 16
8 == 9 | 8 &gt; 16
any(8 == 8, 8 == 9, 8 == 10)
all(8 == 8, 8 == 9, 8 == 10)
8 %in% c(6, 7, 8)
8 %in% c(5, 6, 7)
!(8 %in% c(5, 6, 7))
if(8 == 8) {print(&quot;eight equals eight&quot;)}
if(8 &gt; 16){
  print(&quot;eight is greater than sixteen&quot;)
} else {
  print(&quot;eight is less than sixteen&quot;)
}</code></pre>
</div>
<div id="data-cleaning-transformation-with-dplyr" class="section level1">
<h1>Data cleaning &amp; transformation with dplyr</h1>
<p><img src="DataExploration_files/figure-html/unnamed-chunk-5-1.png" width="672" /></p>
<p>We are now entering the data cleaning and transforming phase. While it is possible to do much of the following using Base R functions (in other words, without loading an external package) <code>dplyr</code> makes it much easier. Like many of the most useful R packages, <code>dplyr</code> was developed by <a href="Hadley%20Wickham">http://hadley.nz/</a>, a data scientist and professor at Rice University.</p>
<div id="renaming-variables" class="section level2">
<h2>Renaming variables</h2>
<p>It is often necessary to rename variables to make them more meaningful. If you print the names of the sample <code>books</code> dataset you can see that some of the vector names are not particularly helpful:</p>
<pre class="r"><code># print names of the books data frame to the console
names(books)
## [1] &quot;CALL...BIBLIO.&quot; &quot;title&quot;          &quot;X245.c&quot;         &quot;LOCATION&quot;       &quot;tot_chkout&quot;     &quot;LOUTDATE&quot;    &quot;SUBJECT&quot;        &quot;ISN&quot;            &quot;CALL...ITEM.&quot;   &quot;X008.Date.One&quot;  &quot;BCODE2&quot;         &quot;BCODE1&quot;    </code></pre>
<p>There are many ways to rename variables in R, but I find the <code>rename()</code> function in the <code>dplyr</code> package to be the easiest and most straightforward. The new variable name comes first. See <code>help(rename)</code>.</p>
<pre class="r"><code># rename the X245.ab variable. Make sure you return (&lt;-) the output to your 
# variable, otherwise it will just print it to the console
books &lt;- dyplr::rename(books,
                       title = X245.ab)

# rename multiple variables at once
books &lt;- dyplr::rename(books,
                       author = X245.c,
                       callnumber = CALL...BIBLIO.,
                       isbn = ISN,
                       pubyear = X008.Date.One,
                       subCollection = BCODE1,
                       format = BCODE2)
books</code></pre>
<p>Side note: where does <code>X245.ab</code> come from? That is the MARC field 245|ab. However, because R variables cannot start with a number, R automatically inserted and X, and because pipes | are not allowed in variable names, R replaced it with a period.</p>
<p>R does this automatically when you use <code>read_csv</code>, but sometimes you need to force it. The <code>clean_names()</code> function from <code>janitor</code> can be used to clean names of data frames. As per the help file, “Resulting names are unique and consist only of the _ character, numbers, and letters.”</p>
<pre class="r"><code># clean_names() can be used for data frames
books &lt;- janitor::clean_names(books)
books

# make_clean_names() can be used for vectors
my_messy_names &lt;- c(&quot;245|ab&quot;, &quot;1.-2&quot;, &quot;space bar&quot;)
janitor::make_clean_names(my_messy_names)
## [1] &quot;x245_ab&quot;   &quot;x1_2&quot;      &quot;space_bar&quot;</code></pre>
</div>
<div id="recoding-values" class="section level2">
<h2>Recoding values</h2>
<p>It is often necessary to recode or reclassify values in your data. For example, in the sample dataset provided to you, the <code>sub_collection</code> (formerly <code>BCODE1</code>) and <code>format</code> (formerly <code>BCODE2</code>) variables contain single characters.</p>
<p>You can do this easily using the <code>recode()</code> function, also in the <code>dplyr</code> package.</p>
<pre class="r"><code># first print to the console all of the unique values you will need to recode
unique(books$sub_collection)
##   [1] &quot;u&quot; &quot;-&quot; &quot;j&quot; &quot;r&quot; &quot;b&quot; &quot;a&quot; &quot;s&quot; &quot;c&quot; &quot;t&quot; &quot;z&quot;

# Use the recode function to assign them. 
# Unlike rename, the old value comes first here. 
books$sub_collection &lt;- dyplr::recode(books$sub_collection,
                                      &quot;-&quot; = &quot;general collection&quot;,
                                      u = &quot;government documents&quot;,
                                      r = &quot;reference&quot;,
                                      b = &quot;k-12 materials&quot;,
                                      j = &quot;juvenile&quot;,
                                      s = &quot;special collections&quot;,
                                      c = &quot;computer files&quot;,
                                      t = &quot;theses&quot;,
                                      a = &quot;archives&quot;,
                                      z = &quot;reserves&quot;)
books </code></pre>
<hr />
<p><strong>TRY IT YOURSELF</strong></p>
<ol style="list-style-type: decimal">
<li>Run <code>unique(books$format)</code> to see the unique values in the <code>format</code> column</li>
<li>Use <code>dyplr::recode()</code> to rename the <code>format</code> values according to the following codes. You <strong>must</strong> put 5 and 4 in quotation marks.</li>
</ol>
</div>
<div id="subsetting-dataframes" class="section level2">
<h2>Subsetting dataframes</h2>
<div id="subsetting-using-brackets-in-base-r" class="section level3">
<h3>Subsetting using brackets in Base R</h3>
<p>In the same way we used brackets to subset vectors, we also use them to subset dataframes. However, vectors have only one direction, but dataframes have two. Therefore we have to use two values in the brackets: the first representing the row, and the second representing the column: <code>[[row, column]]</code>.</p>
<p>When using tibbles, single brackets will return a tibble, but double brackets will return the individual vectors or values without names.</p>
<pre class="r"><code># subsetting a vector 
c(&quot;do&quot;, &quot;re&quot;, &quot;mi&quot;, &quot;fa&quot;, &quot;so&quot;) [1]

# subsetting a data frame:
# pull a single variable into a tibble with names
books[5, 2]
## # A tibble: 1 x 1
##   X245.ab                                              
##   &lt;chr&gt;                                                
## 1 The control room :~how television calls the shots in~

# pull out a single variable without names
books[[5, 2]]
## [1] &quot;The control room :~how television calls the shots in presidential elections /&quot;

# use names to pull data
books[[2, &quot;title&quot;]]
## [1] &quot;The World almanac and book of facts.&quot;

# return the second value in multiple columns
books[2, c(&quot;title&quot;, &quot;format&quot;, &quot;sub_collection&quot;)]
##                          title format      subCollection
## 2 The race for consciousness /   book general collection

# leave the row space blank to return all rows. This will create 
# a tibble of all titles. 
myTitles &lt;- books[, &quot;title&quot;]

# to return a character vector, use double brackets. The comma is then unnecessary.
myTitles_vec &lt;- books[[&quot;title&quot;]]</code></pre>
<p>You can also use the relational operators (see above) to return values based on a logical condition. Below, we use <code>complete.cases()</code> to subset out the NA values. This function evaluates each row and checks if it is an NA value. If it is not, a TRUE value is returned, and vice versa. Since the column space is blank in the brackets <code>[row, column]</code>, it will return all columns.</p>
<pre class="r"><code>completeCallnumbers &lt;- books[complete.cases(books$callnumber), ]</code></pre>
</div>
<div id="subsetting-using-filter-in-the-dplyr-package" class="section level3">
<h3>Subsetting using <code>filter()</code> in the <code>dplyr</code> package</h3>
<p>Subsetting using brackets is important to understand, but as with other R functions, the <code>dplyr</code> package makes it much more straightforward, using the <code>filter()</code> function.</p>
<pre class="r"><code># filter books to return only those items where the format is books
booksOnly &lt;- dyplr::filter(books, format == &quot;book&quot;)

# use multiple filter conditions, 
# e.g. books to include only books with more than zero checkouts
bookCheckouts &lt;- dyplr::filter(books,
                               format == &quot;book&quot;,
                               tot_chkout &gt; 0)

# How many are there? 
# What percentage of all books have at least one checkout?
nrow(bookCheckouts)
## [1] 4267

nrow(bookCheckouts)/nrow(booksOnly) * 100
## [1] 61.10554
# 61%...not bad :-)

library(stringr)
# use the str_detect() function from the stringr package to return all 
# books with the word &quot;Science&quot; in the SUBJECT variable, published after 1999
scienceBooks &lt;- dyplr::filter(books,
                              format == &quot;book&quot;,
                              stringr::str_detect(subject, &quot;Science&quot;), 
                              pubyear &gt; 1999) </code></pre>
<p><strong>TRY IT YOURSELF</strong></p>
<ol style="list-style-type: decimal">
<li>Run <code>unique(format)</code> and <code>unique(sub_collection)</code> to confirm the values in each of these fields.</li>
<li>Create a data frame consisting only of <code>format</code> books. Use the <code>table()</code> function to see the breakdown by <code>sub_collection</code>. Which sub-collection has the most items with 20 or more checkouts?</li>
<li>Create a data frame consisting of <code>format</code> books and <code>sub_collection</code> juvenile materials. What is the average number of checkouts <code>tot_chkout</code> for juvenile books?</li>
<li>Filter the data frame to include books with between 10 and 20 checkouts</li>
</ol>
<hr />
</div>
</div>
<div id="selecting-variables" class="section level2">
<h2>Selecting variables</h2>
<p>The <code>select()</code> function allows you to keep or remove specific variables. It also provides a convenient way to reorder variables.</p>
<pre class="r"><code># specify the variables you want to keep by name
booksTitleCheckouts &lt;- dplyr::select(books, title, tot_chkout)

# specify the variables you want to remove with a -
books &lt;- dyplr::select(books, -call_item)

# reorder columns, combined with everything()
booksReordered &lt;- dyplr::select(books, title, tot_chkout, loutdate, everything())</code></pre>
</div>
<div id="ordering-data" class="section level2">
<h2>Ordering data</h2>
<p>The <code>arrange()</code> function in the <code>dplyr</code> package allows you to sort your data by alphabetical or numerical order.</p>
<pre class="r"><code>booksTitleArrange &lt;- dyplr::arrange(books, title)

# use desc() to sort a variable in descending order
booksHighestChkout &lt;- dyplr::arrange(books, desc(tot_chkout))

# order data based on multiple variables (e.g. sort first by checkout, then by publication year)
booksChkoutYear &lt;- dyplr::arrange(books, desc(tot_chkout), desc(pubyear))</code></pre>
</div>
<div id="creating-new-variables" class="section level2">
<h2>Creating new variables</h2>
<p>The <code>mutate()</code> function allows you to create new variables.</p>
<pre class="r"><code># use the str_sub() function from the stringr package to extract the first character of the callnumber variable (the LC Class)
library(stringr)
booksLC &lt;- mutate(books
                  , lc_class = str_sub(callnumber, 1, 1))</code></pre>
</div>
<div id="putting-it-all-together-with" class="section level2">
<h2>Putting it all together with %&gt;%</h2>
<p>The <a href="https://www.datacamp.com/community/tutorials/pipe-r-tutorial">Pipe Operator</a> <code>%&gt;%</code> is loaded with the <code>tidyverse</code>. It takes the output of one statement and makes it the input of the next statement. You can think of it as “then” in natural language. So in the following example, the <code>books</code> tibble is first loaded, then the format is filtered to include only books, then only the title and tot_chkout columns are selected, and finally the data is rearranged from most to least checkouts.</p>
<pre class="r"><code>myBooks &lt;- books %&gt;%
  dyplr::filter(format == &quot;book&quot;) %&gt;%
  dyplr::select(title, tot_chkout) %&gt;%
  dyplr::arrange(desc(tot_chkout))</code></pre>
<p><strong>TRY IT YOURSELF</strong></p>
<p>Experiment with different combinations of the pipe operator.</p>
<ol style="list-style-type: decimal">
<li>Create a data frame with these conditions:</li>
</ol>
<ul>
<li>filter to include subCollection juvenile &amp; k-12 materials and format books</li>
<li>select only title, call number, total checkouts, and pub year</li>
<li>arrange by total checkouts in descending order</li>
</ul>
<ol start="2" style="list-style-type: decimal">
<li>Create a data frame with these conditions:</li>
</ol>
<ul>
<li>rename the isbn column to all caps: ISBN</li>
<li>filter out NA values in the call number column</li>
<li>filter to include only books published after 1990</li>
<li>arrange from oldest to newest publication year</li>
</ul>
</div>
</div>
<div id="group-and-summarize-data" class="section level1">
<h1>Group and summarize data</h1>
<p><code>group_by()</code> and <code>summarize()</code> are two more powerful <code>dplyr</code> functions. Use <code>group_by()</code> to cluster the dataset together in the variables you specify. For example, if you group by LC Call number class, then you can sum up the total number of ebook user sessions per call number class using <code>summarize()</code>. <code>summarize()</code> will collapse many values down into a single summary statistics.</p>
<p>Here is an example using the <code>booksLC</code> data frame created above.</p>
<pre class="r"><code># First, create the grouped variable
byLC &lt;- group_by(booksLC, lc_class)

# Then, summarize by User.Sessions
checkouts_byLC &lt;- summarize(byLC, total_checkouts = sum(tot_chkout))

# Arrange it
checkouts_byLC &lt;- dyplr::arrange(checkouts_byLC, desc(total_checkouts))</code></pre>
<p>We can use the %&gt;% operator to do both these operations at the same time.</p>
<pre class="r"><code>checkouts_byLC &lt;- byLC %&gt;%
  summarize(total_checkouts = sum(tot_chkout)) %&gt;%
  dyplr::arrange(desc(total_checkouts))</code></pre>
<p>The top 5 are:</p>
<pre class="r"><code>checkouts_byLC$lc_class[1:5]</code></pre>
<p>We may also want to see the total number of books in each call number class, and also calculate the mean user sessions per class:</p>
<ul>
<li>use <code>n()</code> to sum up the total number of ebooks per call number class. Add it as a column called <code>count.</code></li>
<li>use <code>sum(User.Sessions)</code> to add up the cumulative total user sessions per call number class. Add it as a column called <code>totalSessions</code>.</li>
<li>use <code>mean(User.Sessions)</code> to calculate the mean user sessions per call number class. Add it as a column called <code>avgSessions</code>.</li>
</ul>
<pre class="r"><code>byLCSummary &lt;- byLC %&gt;%
  summarize(
    count = n()
    , total_checkouts = sum(tot_chkout)
    , avg_checkouts = mean(tot_chkout)) %&gt;%
  dyplr::arrange(desc(avg_checkouts))</code></pre>
<hr />
</div>
<div id="help-with-dplyr" class="section level1">
<h1>Help with dplyr</h1>
<ul>
<li>Read more about <code>dplyr</code> at <a href="https://dplyr.tidyverse.org/" class="uri">https://dplyr.tidyverse.org/</a>.</li>
<li>In your console, after loading <code>library(dplyr)</code>, run <code>vignette("dplyr")</code> to read an extremely helpful explanation of how to use it.</li>
<li>See the <a href="%22Data%20Transformation%22%20chapter">http://r4ds.had.co.nz/transform.html</a> in Garrett Grolemund and Hadley Wickham’s book <em>R for Data Science.</em></li>
<li>Watch this Data School video: <a href="Hands-on%20dplyr%20tutorial%20for%20faster%20data%20manipulation%20in%20R.">https://www.youtube.com/watch?v=jWjqLW-u3hc</a></li>
</ul>
</div>



</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open')
  });
});
</script>

<!-- code folding -->

<script>
$(document).ready(function ()  {

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_').toLowerCase();
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = false;
    options.smoothScroll = false;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
